<!doctype html>
<section class="head">
<head>
<section class="favicon"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico"></section>
<section class="title"><title>Hive.Loans - v0.0.7</title></section>
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.2/css/all.css">
<link rel="stylesheet" href="/css/mainstatic.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/alertifyjs@1.13.1/build/css/themes/bootstrap.min.css"/>
<link rel="stylesheet" href="/css/contextMenu.css"/>
<link rel="shortcut icon" type="image/x-icon" href="/img/favicon.ico">
</head>
</section>
<body class="context">
<div class="navbar" style="padding-left: 0em;">
  <i class="fas fa-2x fa-flip-horizontal fa-hand-holding-heart sexyblackoutline"></i><i class="fab fa-3x fa-hive sexyblackoutline"></i><i class="fas fa-2x fa-hand-holding-heart sexyblackoutline"></i><b id="handy" class="sexyblackoutline" style="padding-left:0.5em; top: 0em !important; font-variant: petite-caps !important;">Hive.Loans</b>
  <nav style="float:right;">
  <ul class="menu sexyblackoutline">
    <li><a id="wallet" class="hidden" onClick="showWallet()"><b><i class="fas fa-wallet"></i> Wallet</b></a></li>
    <li><a id="profile" class="hidden" onClick="showProfile()"><b><i class="fas fa-user"></i> Profile</b></a></li>
    <li><a id="lend" class="hidden" onClick="showLend()"><b><i class="fas fa-chart-line"></i> Lending</b></a></li>
    <li><a id="loans" class="hidden" onClick="showLoans()"><b><i class="fas fa-piggy-bank"></i> Borrow</b></a></li>
    <li><a id="tools" class="hidden" onClick="showTools();"><b><i class="fas fa-tools"></i> Tools</b></a></li>
    <li><a id="faq" class="hidden" onClick="showFaq();"><b><i class="fas fa-question-circle"></i> FAQ</b></a></li>
    <li><a id="logout" class="hidden" onClick="logout();"><b><i class="fas fa-sign-out-alt"></i> Logout</b></a></li>
    <li><a id="login" class="hidden" onClick="showLogin()"><b><i class="fas fa-sign-in-alt"></i> Login</b></a></li>
    <li><a id="lights" class="hidden"><i class="fas fa-adjust"></i></a></li>
    <li><a id="menuburger" class="hidden" style="position: fixed; top: 0.7em; right: 1.1em;"><b><i class="fas fa-2x fa-bars"></i></b></a></li>
    <li><a id="arrowin" class="hidden" onClick="navbarBlitz()"><i class="fas fa-chevron-right" title="Click here to Grow Menu"></i></a></li>
  </ul>
</nav>
</div>
<div class="content"><!--START content-->
  <!--<span id="userstats" class="userstats hidden" style="padding:5px;text-align: center">
  <span id="statsMove" title="Click and Drag to Move Window"><i class="fas fa-arrows-alt"></i></span><span id="statsName" style="display: inline-block">Loading</span> HIVE Account<span id="refreshAcct" style-"float:right" title="Click to Refresh" onClick="getAcct();"><i class="fas fa-sync"></i></span><hr>
  <span id="statsWrapper">
  <span id="statsBal"><b>HIVE Balance</b>:<br>Loading<br></span><br>
  <span id="statHBDsBal"><b>HBD Balance</b>:<br>Loading<br></span><br>
  <span id="hivePowerHeld"><b>HIVE Power</b>:<br>Loading<br></span><br>
  <span id="recoverAcct"><b>Recovery Account</b>:<br><br><span id="recName">Loading</span><br></span><br>
  <span id="recAlert"></span><br>
  </span>
  </span>-->
  <!--END userstats-->
<span id="backerstats" class="backerstats " style="padding:5px;text-align: center">
<span id="backerMove" title="Click and Drag to Move Window"><i class="fas fa-arrows-alt"></i></span>
<h4><b class="sexyblackoutline" style="color:lawngreen;font-size:larger;">ðŸ’Ž LIMITED TIME OFFER ðŸ’Ž</b>
<br><br><b><i class="far fa-clock"></i> <span id="countdown">Loading...</span><b><br><br>#1 Spot at End of Timer Becomes <b style="color:gold;">Benefactor</b><br>Current King of the Leaderboard: <span id="currentWinner"></span><hr><b style="color:white; font-weight:900;" class="sexyblackoutline">Project Backers Pledge List:</b></h4><span id="refreshBacker" style-"float:right" title="Click to Refresh" onClick="getBackers();"><i class="fas fa-sync"></i></span>
<span id="backerWrapper">
<center>
<span id="activeBackerView" style="padding:15px; width:100% !important;"></span>
<table id="header-fixed" style="width:100% !important;"></table>
</center>
</span><!--END statwrapper-->
</span><!--END userstats-->
<span id="chatpanel" class="chatpanel hidden" style="padding:5px;text-align: center; bottom:1vh !important; right:15vw !important; height:50%; width:15%;">
<span id="chatMove" title="Click and Drag to Move Window"><i class="fas fa-arrows-alt"></i></span><span id="chatName" style="display: inline-block">Loading</span><span id="chatClose" title="Click to Close this Panel" onclick="$('#chatpanel').fadeOut();" onmouseover="$(this).css({'color':'red'})" onmouseout="$(this).css({'color':'black'})"><i class="fas fa-times"></i></span><hr>
<span id="chatWrapper">
<span id="chatContent" style="text-align: left !important;">
<div id="chat">
<ul id="trollbox"></ul>
</div>
<div class="input-group" id="chatinputwidget">
<input type="text" class="trollslot form-control" placeholder="" autocomplete="off" onfocus="this.placeholder = '';" onblur="this.placeholder = ''" aria-describedby="basic-addon1" id="chatText" style="color: white;">
<button type="button" class="sendchat btn btn-default sextext" id="sendChat"><i class="fas fa-paper-plane"></i></button>
</div>
</span>
</span><!--END statwrapper-->
</span><!--END userstats-->
<span id="userpanel" class="userpanel hidden" style="padding:5px;text-align: center; top:20%; height:55%; width:55%;">
<span id="panelMove" title="Click and Drag to Move Window"><i class="fas fa-arrows-alt"></i></span><span id="panelName" style="display: inline-block">Loading</span><span id="panelClose" title="Click to Close this Panel" onclick="$('#userpanel').fadeOut();" onmouseover="$(this).css({'color':'red'})" onmouseout="$(this).css({'color':'black'})"><i class="fas fa-times"></i></span><hr>
<span id="panelWrapper">
<span id="panelContent">Fuck you dolphin</span>
</span><!--END statwrapper-->
</span><!--END userstats-->
<!--
<span id="sitestats" class="sitestats hidden" style="padding:5px;text-align: center;left:70%; height:auto;">
<span id="sitestatssMove" title="Click and Drag to Move Window"><i class="fas fa-arrows-alt"></i></span><span id="sitestatsName" class="sitestatsName" style="display: inline-block"></span><span id="refreshSiteStats" style-"float:right" title="Click to Refresh" onClick="getSiteStats();"><i class="fas fa-sync"></i></span><hr>
<p>Hive.Loans Online Status:<b>X</b></p>
<span id="resizablesitestats" class="ui-widget-content">
<span id="sitestatsBal"><b>Available HIVE Pool</b>:<br>Loading<br></span><br>
<span id="siteLoaned"><b>HIVE Loaned Out</b>:<br>0.000<br></span><br>
<span id="sitePaid"><b>HIVE Repaid</b>:<br>0.000<br></span><br>
<span id="siteProfit"><b>HIVE Lender Profit</b>:<br>0.000<br></span><br>
<span id="siteOnLoan"><b>HIVE Outstanding</b>:<br>0.000<br></span><br>
<span id="siteInterest"><b>Average Interest Rate</b>:<br>0.000%<br></span><br>
<span id="siteTotalActive"><b>Total Active Loans</b>:<br>0<br></span><br>
<span id="siteTotalEnded"><b>Total Ended Loans</b>:<br>0<br></span><br>
<span id="siteLoanTotal"><b>Total Loan Contracts</b>:<br>0<br></span><br>
<span id="siteAlert"></span><br>
<i class="fas fa-vector-square resizer"></i>-->
</span><!--END statwrapper-->
</span><!--END userstats-->
  <div class="container" style="padding:5px;">
    <div class="jumbotron sexyblackoutline" id="jumbotron" style="box-shadow: black 0px 0px 14px 0px;height: 85%; display: block;top:6%; border: 2px outset #eae6e6; border-radius: 15px; color: white !important; background: grey;position:fixed;padding-left:10px;padding-right:10px;">
      <center>
      <h2 class="sexyblackoutline" style="margin-top:0.25em;margin-bottom:0">P2P Lending Contracts on Hive.Loans</h2> <!--Hive.Loans Secured Lending Contract Platform-->
      <span style="font-size:xx-large"><i style="color:gold;" class="fas fa-fw fa-exclamation-triangle"></i> This Website Being Actively Developed and Funded by the DHF <i style="color:gold;" class="fas fa-fw fa-exclamation-triangle"></i></span><br><br>
        <h6 id="supportyourlocaldeveloper" style="font-size:smallest !important; text-decoration: none !important;margin:0 !important;"><a  target="_blank" href="https://peakd.com/proposals/154" style="font-size:large !important; text-decoration: none !important; color:white !important;letter-spacing: initial;"><i class="fas fa-hand-point-right" style="color:white;"></i> If you've a moment and have yet to check out <u><b style="color:#ededed;">Proposal #154</b></u> funding the development of this project, <b style="color:#ededed;">please click here</b> <i class="fas fa-hand-point-left" style="color:white;"></i></a></h6><br><br>
        <img src="/img/redhive.svg"  onclick="showLogin();" style="filter: drop-shadow(2px 4px 6px black); width:31%;"><br><br>
        <button type="button" style="" onclick="showLogin();" class="btn push_button2" title="Click here to verify your HIVE account">&nbsp;&nbsp;Click Here to Continue&nbsp;&nbsp;</button> <!--onclick="showLogin()"     onclick="window.location='https://peakd.com/me/proposals/154'"  -->
        <h3 class="sexyblackoutline" style="color:white;">Offering Secured P2P Trading Sessions, HIVE Borrowing and Liquidity Swapping</h3>
        <h3 class="sexyblackoutline" style="color:white;">Zero Lender Risk Loans - "Set it and Forget it" - Earn 10% to 30% Profit*</h3>
        <h3 class="sexyblackoutline" style="color:white;">Use Your Account as Collateral to Borrow up to 70% of its HIVE Value</h5>
        <h5 class="sexyblackoutline" style="color:white;"><br>Pledge support by becoming a Backer Now to Unlock a Limited Edition Pre-Launch Exclusive Account Perk Bonus by Sending 100+ HIVE to @hive.loans<br>The Backer at the top of the leaderboard when the timer reaches zero wins <b style="color:gold;">Benefactor</b> ranking! They'll recieve 10% of the site revenue paid monthly <b>FOREVER</b></h5>
        <h6>*Backer Rank will Unlock the Limited Edition Pre-Launch Exclusive Account Perk Permenently Increasing Your Maximum Allowed Interest Rate Fee from the Original 30% up to 35% on Lending Contracts</h6>
      <!--<center><sub><b>( by supporting this proposal you'll help feed the developer working on this and directly contribute to the code becoming open sourced when the proposal is accepted )</b></sub><br><br><sub><b style="color:black !important; font-weight:100 !important; font-size:smaller; text-shadow: none !important;"><i class="fas fa-exclamation-triangle sexyblackoutline" style="color:yellow;"></i> <b>NOTE</b>: This is <b><u>EXPERIMENTAL</u></b> software! By using it past this point you agree Hive.Loans are entirely free from any liability<br>including financial responsibility or injuries incurred, regardless of whether injuries are caused by negligence or due to malfunction
      </span>-->
    </center>
    </div>
   </div>
</div><!--END content-->
<section class="footer"><span id="usernamestore"></span><span id="socketid"></span><span id="plugintype"></span><span id="useraddress"></span><span id="newamount"></span><span id="newdays"></span><span id="newfee"></span><span id="userrank"></span>

 <footer style="padding:1vh;" class="sexyblackoutline"><b>&copy; 2021 Hive.Loans v0.0.7 Alpha</b> | <b>P2P Lending Contract Platform built by <a href="https://vote.hive.uno/@klye" style="color:#f0f0f8 !important;text-decoration: none !important;">@KLYE</a></b><span id="blocknumberholder" class="hidden"> | <b>Latest HIVE Block <span id="blocknumber"></span>&nbsp;</b></span><span id="discord" style="color:#f0f0f8 !important;text-decoration: none !important;">Need Help or Have Questions? <a href="https://discord.gg/mtwvCpS" target="_blank" rel="noopener noreferrer" style="color:#f0f0f8 !important;text-decoration: none !important;"><i class="fab fa-fw fa-2x fa-discord sexyblackoutline" style="padding-left:0.5em;padding-right:0.5em;color:#f0f0f8; float:right;margin-right: 2vw; font-size: 1.5em !important; line-height: 0.75em !important; "></i> <b>Join Our Discord</b> <i class="fas fa-angle-right"></i></a></span><span id="github" style='color: #f0f0f8;float: right;margin-top: -0.22em;margin-right: 1.3em;vertical-align: middle;'><a href="https://github.com/KLYE-Dev/hive.loans" target="_blank" rel="noopener noreferrer" style="z-index: 999999; color:#f0f0f8 !important;text-decoration: none !important;"><i class="fab fa-fw fa-2x fa-github-square sexyblackoutline" style="padding-left:0.5em;padding-right:0.5em;color:#f0f0f8; float:right; font-size: 1.5em !important; line-height: 0.75em !important; "></i></a></span>
 </footer>
</body>
<script src="https://cdn.jsdelivr.net/npm/hivesigner@3.2.1/dist/hivesigner.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@hiveio/hive-js/dist/hive.min.js"></script>
<script src="/js/packages/jquery.min.js" /></script>
<script src="/js/packages/jquery-ui/jquery-ui.min.js" /></script>
<script src="/socket.io/socket.io.js"></script>
<script src="/js/packages/countup.js"></script>
<script src="/js/packages/dhive.js"></script>
<script src="/js/packages/bootstrap.js"></script>
<script src="/js/packages/bootstrap-table.min.js"></script>
<script src="/js/packages/contextMenu.min.js"></script>
<script src="/js/packages/bootbox.min.js"></script>
<script src="/js/packages/alertify.min.js"></script>
<script src="/js/packages/colorFader.js"></script>
<script src="/js/packages/acctrecover.js"></script>
<script src="/js/packages/contextMenu.min.js"></script>
<script src="/js/dialogs.js"></script>
<script src="/js/variables.js"></script>
<script src="/js/actions.js"></script>
<script src="/js/visuals.js"></script>
<script src="/js/functions.js"></script>
<script src="/js/connections.js"></script>
<script>
hive.api.setOptions({ url: 'https://hived.privex.io' });
var keyChainEnabled = 0;

window.onload=function(){
  if (window.hive_keychain) {
      hive_keychain.requestHandshake(function() {
          keyChainEnabled = 0;
          console.log("Hive Keychain Handshake Detected!");
      });
  }
  CountDownTimer('02/15/2021 0:0 AM', 'countdown');
  getSiteStats();
  history.pushState("",null, "https://hive.loans");
}

$("#menuburger").on('click', function() {
  alert("MENU!");
});

//setInterval(function(){
//  getBackers();
//}, 30000);


var hivesignerclient = new hivesigner.Client({
  app: 'hive.loans',
  //callbackURL: 'http://127.0.0.1:80', //testing locally
  callbackURL: 'https://hive.loans',    //production
  scope: ['login', 'active']
});

//Set the SteemJS API Node to HIVE else you'll have a bad time!
//185.130.44.165 WITIP NODE
//https://api.hive-roller.com:80


let usercheck = window.localStorage.getItem("user");
let tokencheck = window.localStorage.getItem("token");
let user;
console.log(`usercheck: ${usercheck}`);
console.log(`tokencheck: ${tokencheck}`);
var client;
let linkColor = "black";

var hiveVested;

var currentURL = window.location.href;
currentURL = currentURL.substring("?access_token=", "&username=");
function getJsonFromUrl(url) {
  if(!url) url = location.search;
  var query = url.substr(1);
  var result = {};
  query.split("&").forEach(function(part) {
    var item = part.split("=");
    result[item[0]] = decodeURIComponent(item[1]);
  });
  return result;
}

var success = getJsonFromUrl(currentURL);

console.log(`success:`);
console.log(success);

tokencheck = success.access_token;

if(success.username != null || success.username != undefined){
  user = success.username;
}
if(success.access_token != null || success.access_token != undefined){
  token = success.access_token;
}
if(user != null || user != undefined){
  window.localStorage.setItem("user", user);
} else {
  user = window.localStorage.getItem("user");
}
if(token != null || token != undefined){
  window.localStorage.setItem("token", token);
} else {
  token = window.localStorage.getItem("token");
}

if (token != null && token != undefined && keyChainEnabled === 1){
          $("#statsBalTop").html(`<b>Loading Wallet<span id="dotdotdot"><span>.</span><span>.</span><span>.</span></span></b>`);
  hivesignerclient = new hivesigner.Client({
      app: 'hive.loans',
      //callbackURL: 'http://127.0.0.1', //testing locally
      callbackURL: 'https://hive.loans',    //production
      accessToken: token,
    scope: ['login', 'active']
    });
  hivesignerclient.setAccessToken([token]);

    $("#userstats").removeClass('hidden');
    $("#acct").removeClass('hidden');
    $("#loans").removeClass("hidden");
    $("#lend").removeClass("hidden");
    $("#tools").removeClass("hidden");
    $("#wallet").removeClass("hidden");
    $("#login").addClass('hidden');
    $("#logout").removeClass('hidden');
    $("#arrowin").removeClass('hidden');
    $("#blocknumberholder").removeClass('hidden');

  hivesignerclient.me(function (err, res) {
      if(err){
        console.log(err);
        $("#userstats").addClass('hidden');
        $("#acct").addClass('hidden');
        $("#loans").addClass("hidden");
        $("#lend").addClass("hidden");
        $("#tools").addClass("hidden");
        $("#wallet").addClass("hidden");
         $("#login").addClass('hidden');//$("#login").removeClass('hidden');
        $("#logout").addClass('hidden');
        $("#arrowin").addClass('hidden');
        $("#blocknumberholder").addClass('hidden');
      }
      if(res == null) return;
      var total_vesting_shares;
      var total_vesting_fund;
      var hiveVested;
      var statsName = res.name;
      var acct = res.account;
      var statsBal = acct.balance;
      var statsBalTop = acct.balance;
      var statsHBDBal = acct.hbd_balance;
      var recoverAcct = acct.recovery_account;
      var hivePower = parseInt(acct.vesting_shares);
      loginPush(res.name, token);
      hive.api.getDynamicGlobalProperties(function(err, result) {
        if(err){console.log(err)}
        total_vesting_shares = parseInt(result.total_vesting_shares);
        total_vesting_fund = parseInt(result.total_vesting_fund_steem);
        console.log(`total_vesting_shares: ${total_vesting_shares}`);
        console.log(`total_vesting_fund: ${total_vesting_fund}`);
        console.log(`hivePower: ${hivePower}`);
        hiveVested = ( Number(total_vesting_fund) *  Number(hivePower) ) / Number(total_vesting_shares);
        console.log(`hiveVested: ${hiveVested}`);
        $("#hivePowerHeld").html(`<b>HIVE Power</b>:<br>${toThree(hiveVested)}<br>`);
        $("#statsName").html(`@${statsName}`);
        $("#statsBal").html(`<b>HIVE Balance</b>:<br>${statsBal}<br>`);
        $("#statsBalTop").html(`<b>${statsBalTop} ${statsHBDBal}</b>`);
        $("#statHBDsBal").html(`<b>HBD Balance</b>:<br>${statsHBDBal}<br>`);
        $("#recoverAcct").html(`<b>Recovery Account</b>:<br><span id="recName"><a href='https://hiveblocks.com/@${recoverAcct}' target="_blank" style="color:${linkColor};">@${recoverAcct}</span?</span><br>`);
        if(recoverAcct != 'hive.loans' && recoverAcct != 'anonsteem' && recoverAcct != 'beeanon' && recoverAcct != 'blocktrades') {
          $("#recName").css({"color":"red"});
          linkColor = "red";
          $("#recAlert").html(`<sub><b style="color:red;">Recovery Account Invalid!</b><br>Please set @hive.loan as recovery account! Click here to change recovery account<br><sub>( This will take 30 days to complete )</sub></sub>`);
        } else {
          $("#recName").css({"color":"lawngreen !important","font-weight":"700"});
          linkColor = "lawngreen";
          $("#recAlert").html(`<sub><b style="color:black;">Recovery Account Valid!</b><br>You're ready to borrow! Don't change your recovery account during while borrowing!<br><sub>( Harsh penalties for scam attempts )</sub></sub>`);
        }
      });

  });
    //location.href = "http://127.0.0.1:5000";
    //client.setAccessToken(token);
} else {
  hivesignerclient = new hivesigner.Client({
      app: 'hive.loans',
      //callbackURL: 'http://127.0.0.1', //testing locally
      callbackURL: 'https://hive.loans',    //production
    scope: ['login', 'active']
    });
    $("#login").removeClass("hidden");
    $("#acct").addClass('hidden');
    $("wallet").addClass('hidden');
    $("#logout").addClass("hidden");
    $("#tools").addClass("hidden");
    $("#wallet").addClass("hidden");
    $("#loans").addClass("hidden");
    $("#lend").addClass("hidden");
    $("#blocknumberholder").addClass('hidden');

}


function login() {
  var params = {
    app: 'hive.loans',
    //callbackURL: 'http://127.0.0.1:80', //testing locally
    callbackURL: 'https://hive.loans',    //production
    scope: ['login', 'active']
  }
  // The "username" parameter is required prior to log in for "Steem Keychain" users.
  if (hivesigner.useHiveKeychain) {
    params = {username: $('#usernameinput').val()};
  }
  hivesignerclient.login(params, function(err, token) {
    if(err) console.log(err);
    console.log(token);
  });
}//end function login

function logout() {
  hivesignerclient.revokeToken(function (err, res) {
  if(err){
    console.log(err);
    window.localStorage.clear();
    location.reload(true);
    //location.href = 'https://hive.loans';//"http://127.0.0.1:80";
  }
  if(res){
    console.log(res);
    window.localStorage.clear();
    location.reload(true);
    //location.href = 'https://hive.loans';
  }
});
}

async function getAcct() {
  console.log(`getAcct() called:`);
  $("#hivePowerHeld").html(`<b>HIVE Power</b>:<br>Loading<br>`);
  $("#statsBal").html(`<b>HIVE Balance</b>:<br>Loading<br>`);
  $("#statHBDsBal").html(`<b>HBD Balance</b>:<br>Loading<br>`);
  $("#recoverAcct").html(`<b>Recovery Account</b>:<br><span id="recName">Loading</span><br>`);
  $("#recName").css({"color":"black"});
  $("#recName").html(`Loading`);
  $("#recAlert").html(``);
  if(hkcLogin == true){
    user = window.localStorage.getItem("user");
    await hive.api.getAccounts([user], async function(err, result) {
      if(err){ console.log(err)}
      if(result){
        resultData = result;
      }

      var total_vesting_shares;
      var total_vesting_fund;

      console.log(resultData);
      resultData = resultData[0];
      var statsName = resultData.name;
      var acct = resultData.account;
      var statsBal = resultData.balance;
      var statsBalTop = resultData.balance;
      var statsHBDBal = resultData.hbd_balance;
      var recoverAcct = resultData.recovery_account;
      var hivePower = parseInt(resultData.vesting_shares);
      $("#userouthivebalance").html(`${statsBalTop}`);
      $("#userouthbdbalance").html(`${statsHBDBal}`);
      $("#statsName").html(`@${statsName}`);
      $("#statsBal").html(`<b>HIVE Balance</b>:<br>${statsBal}<br>`);
      $("#lendingBalance").html(`${statsBal} HIVE`);
      $("#statsBalTop").html(`<b>${statsBalTop} ${statsHBDBal}</b>`);
      $("#statHBDsBal").html(`<b>HBD Balance</b>:<br>${statsHBDBal}<br>`);
      $("#recoverAcct").html(`<b>Recovery Account</b>:<br><span id="recName">${recoverAcct}</span><br>`);
      $("#profileRecoverAcct").html(`<span id="precacct">${recoverAcct}</span>`);
      $("#showRecAcct").html(`@${recoverAcct}`);
      await hive.api.getDynamicGlobalProperties(function(err, result) {
        if(err){console.log(err)}
        total_vesting_shares = parseInt(result.total_vesting_shares);
        total_vesting_fund = parseInt(result.total_vesting_fund_hive);
        hiveVested = ( Number(total_vesting_fund) *  Number(hivePower) ) / Number(total_vesting_shares);
        $("#hivePowerHeld").html(`<b>HIVE Power</b>:<br>${toThree(hiveVested)}<br>`);
        $("#loansHPdisplay").html(`<span id="hplevel">${toThree(hiveVested)}</span> HP<br>`);
        loanMax = parseFloat(hiveVested * 0.7);
        if(recoverAcct !== 'hive.loans' && recoverAcct !== 'anonsteem' && recoverAcct !== 'beeanon' && recoverAcct !== 'blocktrades') {
          $("#recName").css({"color":"red"});
          $("#precacct").css({"color":"red"});
          $("#prawarn").css({"color":"red"});
          $("#showRecAcct").css({"color":"red"});
          $("#prawarn").html(`Incompatible Recovery Account!<br><center><b><a href="#" id="changeRecoveryAcct" style="color:white !important; text-decoration:none !important;" onClick="showRecoveryPanel();">Click Here to Change Recovery Account</a></b></center>`);
          $("#recAlert").html(`<sub><b style="color:red;">Recovery Account Invalid!</b><br>Please set @hive.loans as recovery account!<br><br>Click here to change recovery account<br><sub>( This will take 30 days to complete )</sub></sub>`);
        } else {
          $("#recName").css({"color":"lawngreen"});
          $("#precacct").css({"color":"lawngreen"});
          $("#prawarn").css({"color":"white"});
          $("#showRecAcct").css({"color":"lawngreen"});
          $("#prawarn").html(`Compatible Recovery Account!`);
          $("#recAlert").html(`<sub><b style="color:black;">Recovery Account Valid!</b><br>You're ready to borrow! Remember to follow the site guidelines while lending.<br><sub>( Attempts to cheat the system have fees )</sub></sub>`);
        }
      });
    });
  } else {
    hivesignerclient.me(function (err, res) {
      if(err){
        console.log(err);
      }
      //var link = client.getLoginURL(state);
      var total_vesting_shares;
      var total_vesting_fund;
      var hiveVested;
      console.log(res);
      var statsName = res.name;
      var acct = res.account;
      var statsBal = acct.balance;
      var statsBalTop = acct.balance;
      var statsHBDBal = acct.hbd_balance;
      var recoverAcct = acct.recovery_account;
      var hivePower = parseInt(acct.vesting_shares);
      hive.api.getDynamicGlobalProperties(function(err, result) {
        if(err){console.log(err)}
        total_vesting_shares = parseInt(result.total_vesting_shares);
        total_vesting_fund = parseInt(result.total_vesting_fund_hive);
        hiveVested = ( Number(total_vesting_fund) *  Number(hivePower) ) / Number(total_vesting_shares);
        $("#hivePowerHeld").html(`<b>HIVE Power</b>:<br>${toThree(hiveVested)}<br>`);
        $("#loansHPdisplay").html(`<span id="hplevel">${toThree(hiveVested)}</span> HP<br>`);
        loanMax = parseFloat(hiveVested * 0.7);
        if(recoverAcct !== 'hive.loans' && recoverAcct !== 'anonsteem' && recoverAcct !== 'beeanon' && recoverAcct !== 'blocktrades') {
          $("#recName").css({"color":"red"});
          $("#precacct").css({"color":"red"});
          $("#recAlert").html(`<sub><b style="color:red;">Recovery Account Invalid!</b><br>Please set @hive.loans as recovery account!<br><br>Click here to change recovery account<br><sub>( This will take 30 days to complete )</sub></sub>`);
        } else {
          $("#recName").css({"color":"lawngreen"});
          $("#precacct").css({"color":"lawngreen"});
          $("#recAlert").html(`<sub><b style="color:black;">Recovery Account Valid!</b><br>You're ready to borrow! Don't change your recovery account while borrowing!<br><sub>( Harsh penalties for scam attempts )</sub></sub>`);
        }
      });
      $("#statsName").html(`@${statsName}`);
      $("#statsBal").html(`<b>HIVE Balance</b>:<br>${statsBal}<br>`);
      $("#statsBalTop").html(`<b>${statsBalTop} ${statsHBDBal}</b>`);
      $("#lendingBalance").html(`${statsBal} HIVE`);
      $("#statHBDsBal").html(`<b>HBD Balance</b>:<br>${statsHBDBal}<br>`);
      $("#recoverAcct").html(`<b>Recovery Account</b>:<br><span id="recName">${recoverAcct}</span><br>`);
      $("#profileRecoverAcct").html(`<span id="precacct">${recoverAcct}</span>`);
      $("#showRecAcct").html(`@${recoverAcct}`);
  });
  }
}

function getSiteStats() {

  $("#sitestatsBal").html(`<b>HIVE Balance</b>:<br>Loading<br>`);
  $("#recName").css({"color":"black"});
  $("#recName").html(`Loading`);
  $("#recAlert").html(``);
  hive.api.getAccounts(['hive.loans'], function(err, result) {
    if(err){return alert(`Failed to fetch site stats!\n${err}`)}
    if(result){
      console.log(result);
      var res = result[0];
      var statsName = res.name;
      console.log(statsName)
      var acct = res.account;
      var statsBal = res.balance;
      var statsHBDBal = res.hbd_balance;
      var hivePower = parseInt(res.vesting_shares);
      $("#sitestatsName").html(`@${statsName}`);
      $("#sitestatsBal").html(`<b>HIVE Balance</b>:<br>${statsBal}<br>`);
    }
  /*
  <div style="font-size:1.5em;width:100%;"><span id="sitestatssMove" title="Click and Drag to Move Window"><i class="fas fa-arrows-alt"></i></span><span id="sitestatsName" style="display: inline-block">Site Statistics</span><span id="refreshSiteStats" style-"float:right" title="Click to Refresh" onClick="getSiteStats();"><i class="fas fa-sync"></i></span></div><hr>
  <span id="sitestatsWrapper">
  <span id="sitestatsBal"><b>Available HIVE Pool</b>:<br>Loading<br></span>
  <span id="siteLoaned"><b>HIVE Loaned Out</b>:<br>Loading<br></span><br>
  <span id="sitePaid"><b>HIVE Repaid</b>:<br>Loading<br></span><br>
  <span id="siteOnLoan"><b>HIVE Outstanding</b>:<br></span><br>
  */
});
}

function navbarBlitz() {
  var screenWidth = window.innerWidth;
  if((screenWidth / $('.navbar').width()) < 2 ){
    $('.navbar').css({"width":"40%"});
    $('#arrowin').html('<i class="fas fa-chevron-right" title="Click here to Grow Menu"></i>');
  }
  if ((screenWidth / $('.navbar').width()) > 2 ) {
    $('.navbar').css({"width":"99%"});
    $('#arrowin').html('<i class="fas fa-chevron-left" title="Click here to Shrink Menu"></i>');
  }
}

function toThree(n) {
    var number = n.toString().substring(0, n.toString().indexOf(".") + 4);
    parseFloat(number);
    return number;
}

function deposit(amount, type, memo){
  const op = ['transfer', {
    from: '__signer',
    to: 'hive.loans',
    amount: amount + " " + type.toUpperCase(),
    memo: memo
  }];
  hivesigner.sendOperation(op, {}, function(err, result) {
    if(err){alert("Transfer Failed to Send!")}
    if(result){
      return console.log(result);
    }
  });
}

function sendPopup(type, addess){
  var dep = window.prompt(`How Much ${type} do You Wish to Deposit?`, "");
  if (!dep) {
    console.log(`User Cancelled the Deposit`);
  };
  if(dep <= 0){
    alert("Your Deposit Must be Greater Than 0!");
  } else if (isNaN(dep)) {
    alert("Invalid Deposit Amount!");
  } else {
    deposit(dep, type, uAddress);
  }
}

function withdraw(amount, type, user){
  console.log(`withdraw(${amount}, ${type}, ${user})`);
  /*
  const op = ['transfer', {
    from: '__signer',
    to: 'hive.loans',
    amount: amount + " " + type.toUpperCase(),
    memo: '__signer'
  }];
  hivesigner.sendOperation(op, {}, function(err, result) {
    if(err){alert("Transfer Failed to Send!")}
    if(result){
      return console.log(result);
    }
  });
  */
}

if($('#usernameinput').is(":focus")) {

}

function withdrawPopup(amount, type, user){
  var withdraw = window.prompt("How Much HIVE do You Wish to Withdraw?", "");
  if (!withdraw) {
    console.log(`User Cancelled the Withdraw`);
  };
  if(withdraw <= 1){
    alert("Your Withdraw Must be Greater Than 1!");
  } else if (isNaN(dep)) {
    alert("Invalid Withdraw Amount!");
  } else {
    withdraw(amount, type, user);
  }
}

/*
function renderPage(id){
  console.log(`renderPage: ${id}`);
  $("#jumbotron").load(id);
  if(currentURL.length > 25){
    window.history.pushState(" ", " ",  window.location.hostname);
  }
}
*/

$("#statsMove").mousedown(function() {
  $( "#userstats" ).draggable();
});

$("#panelMove").mousedown(function() {
  $( "#userpanel" ).draggable();
});

$("#backerMove").mousedown(function() {
  $( "#backerstats" ).draggable();
});

$("#sitestatssMove").mousedown(function() {
  $( "#sitestats" ).draggable();
});

$("#chatMove").mousedown(function() {
  $( "#chatpanel" ).draggable();
});

$("#jumboMove").mousedown(function() {
  $("#jumbotron").draggable();
});

/*
$("#jumboMove").mousedown(function() {
  $( function() {
      $( "#jumbotron" ).draggable({
        scroll: false,
        drag: function( event, ui ) {
          $('#position').html(
            'Left : ' + ui.position.left + '<br/>' +
            'Top : ' + ui.position.top
          );
        },
        start: function( event, ui ) {
          $('#event').html("Dragging");
        },
        stop: function( event, ui ) {
          $('#event').html("Stopped");
        }
      });
    });
});
*/

$( function() {
  $( "#resizablesitestats" ).resizable();
} );

$(".resizer").mousedown(function() {
  console.log("resizer enabled");
  $(this).parent().resizable();
});

$( ".selector" ).resizable({
  autoHide: true
});


  alertify.defaults = {
        notifier:{delay:5, position:'center', closeButton: true, classes : {
                base: 'alertify-notifier',
                prefix:'ajs-',
                message: 'ajs-message',
                top: 'ajs-top',
                right: 'ajs-right',
                bottom: 'ajs-bottom',
                left: 'ajs-left',
                center: 'ajs-center',
                visible: 'ajs-visible',
                hidden: 'ajs-hidden',
                close: 'ajs-close'
            }
        }
    };

 alertify.set('notifier','position', 'left', 'close');

 jQuery.fn.center = function () {
     this.css("position","absolute");
     this.css("top", Math.max(0, (($(window).height() - $(this).outerHeight()) / 2) + $(window).scrollTop()) + "px");
     this.css("left", Math.max(0, (($(window).width() - $(this).outerWidth()) / 2) +  $(window).scrollLeft()) + "px");
     return this;
 }

</script>
